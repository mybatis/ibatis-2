<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ParameterMapConfig.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">mybatis2</a> &gt; <a href="index.source.html" class="el_package">com.ibatis.sqlmap.engine.config</a> &gt; <span class="el_source">ParameterMapConfig.java</span></div><h1>ParameterMapConfig.java</h1><pre class="source lang-java linenums">/*
 * Copyright 2004-2023 the original author or authors.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.ibatis.sqlmap.engine.config;

import com.ibatis.sqlmap.client.extensions.TypeHandlerCallback;
import com.ibatis.sqlmap.engine.impl.SqlMapClientImpl;
import com.ibatis.sqlmap.engine.mapping.parameter.ParameterMap;
import com.ibatis.sqlmap.engine.mapping.parameter.ParameterMapping;
import com.ibatis.sqlmap.engine.scope.ErrorContext;
import com.ibatis.sqlmap.engine.type.CustomTypeHandler;
import com.ibatis.sqlmap.engine.type.TypeHandler;

import java.util.ArrayList;
import java.util.List;

/**
 * The Class ParameterMapConfig.
 */
public class ParameterMapConfig {

  /** The Constant MODE_IN. */
  public static final String MODE_IN = &quot;IN&quot;;

  /** The Constant MODE_OUT. */
  public static final String MODE_OUT = &quot;OUT&quot;;

  /** The Constant MODE_INOUT. */
  public static final String MODE_INOUT = &quot;INUOT&quot;;

  /** The config. */
  private SqlMapConfiguration config;

  /** The error context. */
  private ErrorContext errorContext;

  /** The client. */
  private SqlMapClientImpl client;

  /** The parameter map. */
  private ParameterMap parameterMap;

  /** The parameter mapping list. */
  private List parameterMappingList;

  /**
   * Instantiates a new parameter map config.
   *
   * @param config
   *          the config
   * @param id
   *          the id
   * @param parameterClass
   *          the parameter class
   */
<span class="fc" id="L68">  ParameterMapConfig(SqlMapConfiguration config, String id, Class parameterClass) {</span>
<span class="fc" id="L69">    this.config = config;</span>
<span class="fc" id="L70">    this.errorContext = config.getErrorContext();</span>
<span class="fc" id="L71">    this.client = config.getClient();</span>
<span class="fc" id="L72">    errorContext.setActivity(&quot;building a parameter map&quot;);</span>
<span class="fc" id="L73">    parameterMap = new ParameterMap(client.getDelegate());</span>
<span class="fc" id="L74">    parameterMap.setId(id);</span>
<span class="fc" id="L75">    parameterMap.setResource(errorContext.getResource());</span>
<span class="fc" id="L76">    errorContext.setObjectId(id + &quot; parameter map&quot;);</span>
<span class="fc" id="L77">    parameterMap.setParameterClass(parameterClass);</span>
<span class="fc" id="L78">    errorContext.setMoreInfo(&quot;Check the parameter mappings.&quot;);</span>
<span class="fc" id="L79">    this.parameterMappingList = new ArrayList();</span>
<span class="fc" id="L80">    client.getDelegate().addParameterMap(parameterMap);</span>
<span class="fc" id="L81">  }</span>

  /**
   * Adds the parameter mapping.
   *
   * @param propertyName
   *          the property name
   * @param javaClass
   *          the java class
   * @param jdbcType
   *          the jdbc type
   * @param nullValue
   *          the null value
   * @param mode
   *          the mode
   * @param outParamType
   *          the out param type
   * @param numericScale
   *          the numeric scale
   * @param typeHandlerImpl
   *          the type handler impl
   * @param resultMap
   *          the result map
   */
  public void addParameterMapping(String propertyName, Class javaClass, String jdbcType, String nullValue, String mode,
      String outParamType, Integer numericScale, Object typeHandlerImpl, String resultMap) {
<span class="fc" id="L107">    errorContext.setObjectId(propertyName + &quot; mapping of the &quot; + parameterMap.getId() + &quot; parameter map&quot;);</span>
    TypeHandler handler;
<span class="fc bfc" id="L109" title="All 2 branches covered.">    if (typeHandlerImpl != null) {</span>
<span class="fc" id="L110">      errorContext.setMoreInfo(&quot;Check the parameter mapping typeHandler attribute '&quot; + typeHandlerImpl</span>
          + &quot;' (must be a TypeHandler or TypeHandlerCallback implementation).&quot;);
<span class="pc bpc" id="L112" title="1 of 2 branches missed.">      if (typeHandlerImpl instanceof TypeHandlerCallback) {</span>
<span class="fc" id="L113">        handler = new CustomTypeHandler((TypeHandlerCallback) typeHandlerImpl);</span>
<span class="nc bnc" id="L114" title="All 2 branches missed.">      } else if (typeHandlerImpl instanceof TypeHandler) {</span>
<span class="nc" id="L115">        handler = (TypeHandler) typeHandlerImpl;</span>
      } else {
<span class="nc" id="L117">        throw new RuntimeException(</span>
            &quot;The class '&quot; + typeHandlerImpl + &quot;' is not a valid implementation of TypeHandler or TypeHandlerCallback&quot;);
      }
    } else {
<span class="fc" id="L121">      errorContext.setMoreInfo(&quot;Check the parameter mapping property type or name.&quot;);</span>
<span class="fc" id="L122">      handler = config.resolveTypeHandler(client.getDelegate().getTypeHandlerFactory(),</span>
<span class="fc" id="L123">          parameterMap.getParameterClass(), propertyName, javaClass, jdbcType);</span>
    }
<span class="fc" id="L125">    ParameterMapping mapping = new ParameterMapping();</span>
<span class="fc" id="L126">    mapping.setPropertyName(propertyName);</span>
<span class="fc" id="L127">    mapping.setJdbcTypeName(jdbcType);</span>
<span class="fc" id="L128">    mapping.setTypeName(outParamType);</span>
<span class="fc" id="L129">    mapping.setResultMapName(resultMap);</span>
<span class="fc" id="L130">    mapping.setNullValue(nullValue);</span>
<span class="pc bpc" id="L131" title="1 of 4 branches missed.">    if (mode != null &amp;&amp; mode.length() &gt; 0) {</span>
<span class="fc" id="L132">      mapping.setMode(mode);</span>
    }
<span class="fc" id="L134">    mapping.setTypeHandler(handler);</span>
<span class="fc" id="L135">    mapping.setJavaType(javaClass);</span>
<span class="fc" id="L136">    mapping.setNumericScale(numericScale);</span>
<span class="fc" id="L137">    parameterMappingList.add(mapping);</span>
<span class="fc" id="L138">    parameterMap.setParameterMappingList(parameterMappingList);</span>
<span class="fc" id="L139">  }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>